<div class="bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 text-gray-200 animate-fade-in border border-white border-opacity-20">
  <h2 class="text-2xl font-bold text-cyan-400 my-6 border-t border-b border-gray-700 py-6 text-center">Player Rankings</h2>

  <div class="overflow-x-auto">
    <table class="w-full text-left">
      <thead class="text-xs text-gray-400 uppercase bg-gray-700/50">
        <tr>
          <th scope="col" class="px-4 py-3 text-center">Rank</th>
          <th scope="col" class="px-6 py-3">Player</th>
          <th scope="col" class="px-4 py-3 text-center">Elo</th>
          <th scope="col" class="px-6 py-3 text-center">Record (W-L-D)</th>
          <th scope="col" class="px-4 py-3 text-center">Tournaments</th>
        </tr>
      </thead>
      <tbody>
        @for (player of rankedPlayers(); track player.id; let i = $index) {
          <tr 
            class="border-b border-gray-700 hover:bg-gray-700/50 cursor-pointer"
            (click)="toggleExpand(player.id)">
            <td class="px-4 py-4 text-center font-bold text-lg">{{ i + 1 }}</td>
            <td class="px-6 py-4 font-medium text-white">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center font-bold text-cyan-300">
                  {{ player.jerseyNumber }}
                </div>
                <span>{{ player.name }}</span>
              </div>
            </td>
            <td class="px-4 py-4 text-center font-mono">
              {{ player.elo }}
              <span [class]="getEloChangeClass(player)">
                ({{ player.lastEloChange ?? 0 > 0 ? '+' : '' }}{{ player.lastEloChange ?? 0 }})
              </span>
            </td>
            <td class="px-6 py-4 text-center font-mono">
              {{ player.stats.wins }}-{{ player.stats.losses }}-{{ player.stats.draws }}
            </td>
            <td class="px-4 py-4 text-center font-bold text-lg">
              {{ player.tournamentWins }}
            </td>
          </tr>
          @if (expandedPlayerId() === player.id) {
            <tr class="bg-gray-900/50">
              <td colspan="5" class="p-4">
                <div class="animate-fade-in-fast">
                  <h4 class="text-lg font-semibold mb-3 text-cyan-300">Head-to-Head Stats</h4>
                  @if (headToHeadStats() && headToHeadStats()!.length > 0) {
                    <ul class="space-y-3">
                    @for (stats of headToHeadStats(); track stats.opponentJersey) {
                        <li class="p-3 bg-gray-700 rounded-md">
                          <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                              <div class="w-7 h-7 rounded-full bg-gray-800 flex items-center justify-center font-bold text-sm">
                                {{ stats.opponentJersey }}
                              </div>
                              <span class="font-semibold">{{ stats.opponentName }}</span>
                            </div>
                            <span class="font-mono">{{ stats.wins }}-{{ stats.losses }}-{{ stats.draws }}</span>
                          </div>
                          <div class="w-full bg-gray-600 rounded-full h-2.5 mt-2">
                            <div class="bg-gradient-to-r from-cyan-500 to-orange-400 h-2.5 rounded-full" [style.width.%]="getWinPercentage(stats)"></div>
                          </div>
                        </li>
                    }
                    </ul>
                  } @else {
                    <p class="text-gray-400">No matches played against other opponents yet.</p>
                  }
                </div>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>
</div>

<style>
  @keyframes fade-in-fast {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in-fast {
    animation: fade-in-fast 0.3s ease-out forwards;
  }
</style>